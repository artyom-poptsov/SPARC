\documentclass[../sparc.tex]{subfiles}
\graphicspath{{\subfix{../images/}}}
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Использование массива для программирования мелодии}

\emph{Массив} -- это переменная, состоящая из группы других переменных одного
типа. В массиве мы сможем хранить ноты нашей мелодии.

Визуально массив можно представить в виде последовательности ``коробочек'',
каждая из которых имеет порядковый номер (называемый \emph{индексом}) и может
хранить один элемент (\ref{table:array-example-1}.)

\begin{tabular}{|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|}
  \hline
  c4 & c4 & g4 & g4 & a4 & a4 & g4 \\
  \hline
  \multicolumn{1}{c}{0}
  & \multicolumn{1}{c}{1}
  & \multicolumn{1}{c}{2}
  & \multicolumn{1}{c}{3}
  & \multicolumn{1}{c}{4}
  & \multicolumn{1}{c}{5}
  & \multicolumn{1}{c}{6}
  \label{table:array-example-1}
\end{tabular}

В приведённом примере массив хранит семь элементов, при этом номер (индекс)
первого элемента равен нулю (``Настоящие программисты считают с нуля!''), а
номер последнего равен шести. Если мы попытаемся взять несуществующий элемент
(например, седьмой, или минус первый), то это приведёт к ошибке.

Нам нужно создать массив из нужного количества элементов, если быть точным, то
28 элементов, по количеству нот, используемых в нашей мелодии, и заполнить
массив значениями. Всё так же, как и раньше -- указываем тип переменной и её
название, но чтобы указать, что это массив, после имени пишем квадратные скобки
и в них количество элементов, из которых будет состоять массив:

\begin{minted}{cpp}
float melody[28] = {
  c4, c4, g4, g4,
  a4, a4, g4,
  f4, f4, e4, e4,
  d4, d4, c4,
  g4, g4, f4, f4,
  e4, e4, d4,
  g4, g4, f4, f4,
  e4, e4, d4,
};
\end{minted}

Для обращения к определённым элементам массива нужно написать имя массива и в
квадратных скобках номер элемента. Например, если захотелось нам поменять
значение нулевого элемента, то мы могли бы сделать это так:

\begin{minted}{cpp}
melody[0] = g4;
\end{minted}

Этот массив стоит объявить перед функцией \texttt{loop} в нашей программе.
Внутри же loop мы можем пройтись по данному массиву в цикле и воспроизвести
каждую из нот, использовав в качестве номера элемента счётчик цикла:

\begin{minted}{cpp}
// ...

void loop() {
  const long BPM = 120;
  const long MINUTE = 60 * 1000000;
  const long T = (MINUTE / BPM) * 4;

  for (int note_idx = 0; note_idx < 28; note_idx++) {
    play_tone(SPEAKER_PIN, melody[note_idx], T / 4);
    delay(100);
  }
}
\end{minted}

Заметьте, насколько сократилась запись нашей мелодии. Однако мы временно
потеряли возможность задавать длительность для каждой ноты в отдельности.

Чтобы это исправить, можно создать дополнительный массив с длительностями нот --
назовём его \texttt{melody\_t}.

Каждый элемент нашего массива \texttt{melody\_t} будет содержать длительность
ноты из массива \texttt{melody} в виде знаменателя простой дроби, где в
числителе у нас находится длина такта. Например, нота номер ноль (``C4'') из
массива \texttt{melody} имеет в музыкальном произведении длительность
$\frac{1}{4}$, следовательно её длительность в массива \texttt{melody\_t} будет
записана, как 4.

\begin{minted}{cpp}
// Массив с нотами (их частотами.)
float melody[28] = {
  c4, c4, g4, g4,
  a4, a4, g4,
  f4, f4, e4, e4,
  d4, d4, c4,
  g4, g4, f4, f4,
  e4, e4, d4,
  g4, g4, f4, f4,
  e4, e4, d4,
};

// Массив с длительностями нот.
float melody_t[28] = {
  4,  4,  4,  4,
  4,  4,  2,
  4,  4,  4,  4,
  4,  4,  2,
  4,  4,  4,  4,
  4,  4,  2,
  4,  4,  4,  4,
  4,  4,  2,
};
\end{minted}

После этого следует обновить наш код воспроизведения мелодии:

\begin{minted}{cpp}
// ...

void loop() {
  const long BPM = 120;
  const long MINUTE = 60 * 1000000;
  const long T = (MINUTE / BPM) * 4;

  for (int note_idx = 0; note_idx < 28; note_idx++) {
    play_tone(SPEAKER_PIN,
              melody[note_idx],
              T / melody_t[note_idx]);
    delay(100);
  }
}
\end{minted}

Обратите внимание на код \texttt{T / melody\_t[note\_idx]}, который рассчитывает
как раз длительность ноты -- в числителе простой дроби стоит \texttt{T}, а в
знаменателе -- \texttt{melody\_t[note\_idx]}.

\begin{equation}
  \mbox{Длина ноты в микросекундах} = \frac{\mbox{T}}{\mbox{melody\_t[note\_idx]}}
\end{equation}

При всём этом запись из двух массивов выглядит достаточно громоздко, так как
нужно следить за тем, чтобы оба массива (нот и их длительностей) совпадали по
размеру.

Чтобы решить эту проблему, мы можем использовать двумерные массивы, о которых
пойдёт речь в следующем разделе.

\end{document}
