\documentclass[../sparc.tex]{subfiles}
\usetikzlibrary{math}
\graphicspath{{\subfix{../images/}}}
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Анимация}
\index{Разработка игр!Анимация}

В данном разделе мы сделаем так, чтобы игрок поворачивался в ту сторону, в
которую он идёт.  Для этого нам необходимо сделать три варианта ``модели''
персонажа: первая, где персонаж стоит на месте; вторая, где персонаж смотрит
вправо и третья, где персонаж смотрит влево.

Чтобы съэкономить драгоценные ячейки под собственные в памяти дисплея, мы будем
использовать один и тот же код символа, меняя при этом отрисовку этого символа.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Добавление необходимых символов}

У персонажа нашей игры будет три состояния: перемещение влево (``LEFT''),
бездействие (``IDLE''), перемещение вправо (``RIGHT'').  Для каждого из этих
состояний необходимо сделать ``текстуру'', которая будет применяться
(см. рис. \ref{fig:game-dev-player-textures}.)

\figureLCDCharAnimation{ru}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Реализация анимации}

Для того, чтобы реализовать анимацию поворота игрока в сторону направления
движения, нам необходимо добавить вызов \texttt{createChar} непосредственно в
код функции \texttt{loop}.

Первым делом после вызова \texttt{map\_show} мы добавим перезапись символа игрока
для того, чтобы вернуть его в бездействующее положение.

\begin{minted}{cpp}
  void loop() {
    map_show();
    lcd.createChar(PLAYER, player_idle_image);
    // ...
  }
\end{minted}

Затем мы должны перезаписывать символ игрока каждый раз, когда мы видим, что
нажата кнопка вправа или влево.

\begin{minted}{cpp}
  void loop() {
    map_show();
    lcd.createChar(PLAYER, player_idle_image);

    if (digitalRead(BUTTON_R) == LOW) {
      lcd.createChar(PLAYER, player_right_image);
      player_x++;
    }
    if (digitalRead(BUTTON_L) == LOW) {
      lcd.createChar(PLAYER, player_left_image);
      player_x--;
    }
  }
\end{minted}

\end{document}
