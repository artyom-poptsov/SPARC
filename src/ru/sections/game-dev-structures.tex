\documentclass[../sparc.tex]{subfiles}
\graphicspath{{\subfix{../images/}}}
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Структуры}
\index{Программирование!Структуры}

При разработке таких комплексных проектов, как компьютерные игры, важно
поддерживать структуированность кода.  Мы уже видим, что некоторые из
вспомогательных процедур игры принимают по два, а то и более параметров.  Кроме
того, мы уже оперируем такими сложными сущностями, как ``Игрок'', ``Игровая
карта'', ``Игровой объект'' и т.п.

В таких условиях передача разрозненных переменных, обозначающих какой-то
конкретный объект, в процедуры, уже не выглядит хорошей идеей.  Лучше было бы
объединить, например, координаты игрока и его очки здоровья в некий комплексный
объект, который целиком передавать в процедуры для обработки.

К счастью, у нас есть способ это сделать -- с помощью \emph{структур}.  Структура
есть спецальный тип переменной, который позволяет хранить внутри неё несколько
разнотипных значений.  Это похоже на обычный массив, однако если в массиве все
элементы принадлежат одному типу, то в стурктуре можно использовать несколько
разных типов для полей.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Объявление}
\index{Программирование!Структуры!Объявление}

Например, структура, которая описывает игрока, может выглядить вот так:

\begin{listing}[H]
  \begin{minted}{cpp}
    struct player {
      int x;
      int y;
      char image;
      byte hp;
    };
  \end{minted}
  \caption{Описание игрока в виде структуры.}
  \label{listing:game-dev-structure}
\end{listing}

Переменные \texttt{x}, \texttt{y}, \texttt{image} и \texttt{hp} являются
\emph{полями} структуры -- они как бы описывают \emph{свойства} объекта.

Объявить структуру можно, например, где-то в глобальной области, за пределами
процедур нашей программы.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Создание и инициализация структур}
\index{Программирование!Структуры!Создание и инициализация}

Чтобы создать игрока, мы должны создать \emph{экземпляр} структуры.

\begin{listing}[H]
  \begin{minted}{cpp}
    // Создание переменной "p",
    // хранящей экземпляр структуры "player":
    struct player p;
  \end{minted}
  \caption{Создание экземпляра структуры.}
  \label{listing:game-dev-structure-instance}
\end{listing}

При создании переменной мы должны её инициализировать.  Со структурами дело
обстоит также -- и мы можем выполнить инициализацию сразу при создании экземпляра
структуры:

\begin{listing}[H]
  \begin{minted}{cpp}
    // Создание переменной "p",
    // хранящей экземпляр структуры "player":
    struct player p = {
      0,   // x
      0,   // y
      '@', // image
      100  // HP
    };
  \end{minted}
  \caption{Инициализация экземпляра структуры при объявлении.}
  \label{listing:game-dev-structure-instance-init}
\end{listing}

Важно отметить, что задание значений для полей структуры должно выполняться в
том же порядке, в каком они перечислены в описании структуры.  Обратите внимание
на комментарии возле значений в листинге
\ref{listing:game-dev-structure-instance-init} -- они добавлены специально, чтобы
не перепутать порядок значений.  Это, например, позволяет избежать ситуации,
когда у нас очки здоровья внезапно окажутся кодом символа изображения игрока.

Чтобы решить проблему очередности задания значений, можно воспользоваться
следующим синтаксисом:

\begin{listing}[H]
  \begin{minted}{cpp}
    // Создание переменной "p",
    // хранящей экземпляр структуры "player":
    struct player p = {
      .x     = 0,
      .y     = 0,
      .image = '@',
      .hp    = 100
    };
  \end{minted}
  \caption{Инициализация экземпляра структуры при объявлении, с указанием имён
    полей.}
  \label{listing:game-dev-structure-instance-init-names}
\end{listing}

Способ, показанный в листинге
\ref{listing:game-dev-structure-instance-init-names} позволяет задавать значения
для полей структуры в произвольном порядке, указывая названия полей явно.  При
этом, отпадает необходимость в добавлении комментариев к значением, т.к. по
названию полей можно понять, какое значение что обозначает.  К сожалению, данный
способ не поддерживается на некоторых платформах, в частности, на Arduino.

Ещё одним способом инициализации может быть присвоение значений полям структуры
уже после создания её экземпляра.

\begin{listing}[H]
  \begin{minted}{cpp}
    // Создание переменной "p",
    // хранящей экземпляр структуры "player":
    struct player p;

    void setup() {
      // Задание значений для полей структуры:
      p.x = 0;
      p.y = 0;
      p.hp = 100;
      p.image = '@';
    }
  \end{minted}
  \caption{Задание значений для полей структуры после её создания.}
  \label{listing:game-dev-structure-assignment}
\end{listing}

Обращение к полям структуры производится по именам, которые пишутся через точку.
Точка разделяет имя переменной, хранящей структуру, и поле, к которому идёт
обращение.  Как и в случае с обычными переменными, мы можем присваивать значения
полям структуры и подставлять значения полей в выражения.

\end{document}
