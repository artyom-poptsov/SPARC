\documentclass[../sparc.tex]{subfiles}
\graphicspath{{\subfix{../images/}}}
\begin{document}

\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Сдвиговые регистры}
\label{section:shift-registers}
\index{Электроника!Сдвиговый регистр}

Теперь, когда мы разобрались с битовыми операциями, пришло время их попробовать
в действии на примере работы со \emph{сдвиговыми регистрами}.  Сдвиговые
регистры, также иногда называемые расширителями портов ввода-вывода, позволяют
нам расширить количество цифровых портов на микроконтроллере.  Часто они
используются для медленной периферии с большим количеством выводов -- например,
для подключения семисегментных индикаторов и массивов кнопок к микроконтроллеру.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Последовательно-параллельный регистр}

Последовательно-параллельный сдвиговый регистр преобразует последовательный
набор сигналов (двоичный код) в параллельный.

Примером применения подобного регистра служит управление набором светодиодов или
семисегментным индикатором.

Примером является микросхема 74HC595.  Расположение контактов (или, как говорят,
\emph{распиновка}) данной микросхемы показана на
рис. \ref{fig:shift-register-sipo}.

\figureShiftRegisterSIPO{ru}

Назначение ножек микросхемы описано в таблице
\ref{table:shift-register-sipo-pins}.

\begin{table}[H]
  \centering
  \begin{tabular}{ | m{1.5cm} | m{2.5cm} | m{6.0cm} | }
    \hline
    \textbf{Ножка}
    & \textbf{Альтернативные названия}
    & \textbf{Описание} \\
    \hline
    GND
    & GROUND
    & Земля, должна быть подключена к контакту ``GND'' на Arduino. \\
    \hline
    $V_{cc}$
    &
    & Напряжение питания, должна быть подключена к 5V. \\
    \hline
    Q0...Q7
    & QA...QH
    & Выходы сдвигового регистра. \\
    \hline
    DS
    & ``DATA'', ``SER''
    & Входная линия данных. \\
    \hline
    $\overline{OE}$
    & ``Output Enabled''
    & Работает, как включатель и выключатель
    для выходных сигналов на ножках Q0..Q7. \\
    \hline
    ST\_CP
    & ``LATCH''
    & ``Защёлка'', включает вывод значений из
    памяти микросхемы на ножки Q0..Q7. \\
    \hline
    SH\_CP
    & ``CLOCK'', ``SRCLK'' (Shift Register Clock)
    & Контролирует загрузку данных в регистр.  По данной линии должен подаваться
    тактовый импульс. При изменении значения с \texttt{LOW} в \texttt{HIGH}
    происходит загрузка одного бита с линии ``DS'' в сдвиговый регистр. \\
    \hline
    $\overline{MR}$
    & ``RESET'', ``SRCLR'' (Shift Register Clear)
    & Сброс.  Используется для сброса всех значений в памяти регистра в ноль.
    Сброс происходит при выставлении значения в \texttt{LOW}. \\
    \hline
    QA
    & Q7', QH'
    & Последовательный выход.  К данной ножке может быть подключена ножка ``DS''
    следующего сдвигового регистра.  На данную ножку ``выдвигается'' наиболее
    значимый бит из памяти регистра при сдвиге. \\
    \hline
  \end{tabular}
  \caption{Описание назначения ножек сдвигового регистра 74HC595.}
  \label{table:shift-register-sipo-pins}
\end{table}

Принцип работы регистра показан на рис. \ref{fig:shift-register-sipo-diagram}.

\figureShiftRegisterSIPODiagram{ru}

В примере показана загрузка числа 37 (\mintinline{cpp}{0b00100101}) в сдвиговый
регистр.  На линии данных (\texttt{DATA}) последовательно выставляются
логические значения, соответствующие значению каждого бита загружаемого в
регистр числа.  По изменению тактового импульса (\texttt{CLOCK}) со значения 0
(\texttt{LOW}) в значение 1 (\texttt{HIGH}) происходит загрузка бита в регистр.
По завершению загрузки значение на защёлке (\texttt{LATCH}) меняется с 0 на 1,
что приводит к выставлению на ножках Q1...Q7 значений, соответствующих значениям
бит в памяти регистра.

Функция загрузки одного байта в сдвиговый регистр:

\begin{listing}[H]
  \begin{minted}[highlightlines={12-21}]{cpp}
    // Порты, подключенные с сдвиговому регистру.
    const byte DATA  = 2;
    const byte CLOCK = 3;
    const byte LATCH = 4;

    void setup() {
      pinMode(DATA, OUTPUT);
      pinMode(CLOCK, OUTPUT);
      pinMode(LATCH, OUTPUT);
    }

    // Функция работы со сдвиговым регистром.
    void shift_out(byte value) {
      for (int i = 7; i >= 0; i--) {
        digitalWrite(DATA, (value & (1 << i)) > 0);
        digitalWrite(CLOCK, HIGH);
        digitalWrite(CLOCK, LOW);
      }
      digitalWrite(LATCH, HIGH);
      digitalWrite(LATCH, LOW);
    }

    void loop() {
      shift_out(0b01010101);
    }
  \end{minted}
  \label{listing:communication-sipo-shift-out}
  \caption{Функция последовательной загрузки одного байта в сдвиговый регистр.}
\end{listing}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Параллельно-последовательный регистр}

Параллельно-последовательный регистр преобразует параллельные сигналы в
последовательный сигнал (двоичный код.)

Примером применения подобного регистра служит получение данных с массива кнопок.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Универсальный регистр}

Универсальный регистр может работать в обоих направлениях, в зависимости от
конфигурации.  Имеет параллельные и последовательные порты для загрузки и
выгрузки данных, а также порт для задания направления движения данных.

Примером является микросхема 74LS194.

\end{document}
