\documentclass[../sparc.tex]{subfiles}
\graphicspath{{\subfix{../images/}}}
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Control Flow}

Statements (or so called \emph{operators}) of a programming language, that are
responsible for controlling the flow of program's execution, are called
\emph{control flow statements}.  They include \emph{branching}, \emph{loop}
statements and others alike.  Generally we can say that if a statement changes
the sequential flow of execution of a program then this statement is one of the
control flow statements group.

In this section we will discuss the main types of the control flow statements
that are present in C++ and many other popular programming languages.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Conditionals}
\index{Programming!Conditionals}

Sometimes a program needs to decide what to do next in the runtime.  For a
computer to choose the right way to go we (the programmers) need to describe a
conditional statement in the program code: if a logical expression is true then
we do one thing, if it is not -- we do something other.

Conditional statements are described using special control flow statements.  In
C++ we have two main statements.  The first one is the \texttt{if} operator.

Here's an example:

\begin{listing}[ht]
  \begin{minted}{cpp}
    int a = 42;
    if (a > 10) {
      // A code that is executed only when the value of 'a' variable
      // is greater than 10.  In this case this code will always
      // be executing because the variable is always equals to 42.
    }
  \end{minted}
  \label{listing:dialogues-with-computer-if-more-than}
  \caption{Example of (\texttt{if}) usage to check if the variable value is
    greater than 10.}
\end{listing}

When we need to check if a variable value is equal to some other value we use
``=='' (strict equal) as shown on the listing
\ref{listing:dialogues-with-computer-if-equals}.

\begin{listing}[ht]
  \begin{minted}{cpp}
    int a = 42;
    if (a == 10) {
      // A sequence of commands that will be executed if
      // the 'a' value is equal to 10.  In this example this
      // piece of code will never be executed as the variable
      // value is always 42 and will never be 10.
    }
  \end{minted}
  \label{listing:dialogues-with-computer-if-equals}
  \caption{An example of \texttt{if} usage to check if the variable value is
    equal to 10.}
\end{listing}

\note{ Don't confuse \emph{equality operator} ``=='' with \emph{assignment
  operator} ``='' -- this is important!  The point is that in many cases C/C++
  programming languages allow us to use either of the operators in one place
  interchangeably but the results will be completely different depending on the
  used operator.  In C++ ``='' symbol has different roles but if we are talking
  about working with variables then this operator always changes the variable
  that is on the left of assignment operator. }

The easiest way to remember the difference between those two operations is that
single ``='' sign means assignment and ``=='' is equality operator.

\begin{listing}[ht]
  \begin{minted}{cpp}
    int a = 42;
    if (a = 10) {
      // This sequence of commands will always be executed
      // as the ``a = 10'' stores 10 in ``a'' variable so
      // the value of the overall expression is 10 which means
      // ``true'' in C/C++.
    }
  \end{minted}
  \label{listing:dialogues-with-computer-if-equals-assignment}
  \caption{An example of the error that is introduced into the code by using
    ``='' instead of ``==''.}
\end{listing}

In the listing \ref{listing:dialogues-with-computer-if-equals-assignment} the
\texttt{if} body will always be executed despite the fact that \texttt{a} is
equal to 42 before \texttt{if} -- the reason for that is that the assignment
operator inside the parenthesis \emph{changes} the value of \texttt{a} to 10.
Then \texttt{a} variable is substituted with its value inside the parenthesis.
In C/C++ Boolean values are just numbers: zero is ``false'', any other value is
considered as ``true''.  Which means that the number 10 means ``true'' as well
when is used as a value in logical expressions.

Often you need to provide not only the code to be executed if the condition
inside \texttt{if} parenthesis is true, but also some code that needs to be
executed when the condition is false.  In such cases one can use
\texttt{if..else} statement:

\begin{listing}[ht]
  \begin{minted}{cpp}
    int a = 42;
    if (a > 10) {
      // Some code that needs to be executed when
      // the value of 'a' is greater than 10.
    } else {
      // Code that is executed when 'a' value is less
      // or equal to 10.
    }
  \end{minted}
  \label{listing:dialogues-with-computer-if-with-else}
  \caption{An example of \texttt{if} usage with \texttt{else} block.}
\end{listing}

Another statement that is often used is \texttt{switch..case} also known as
\emph{multiple choice operator}.  This statement is convenient when it comes to
choosing from multiple cases of a variable value.

\begin{listing}[ht]
  \begin{minted}{cpp}
    int a = 42;
    switch (a) {
      case 10:
      // A set of instructions to be executed
      // when 'a' value equals to 10.
      break;
      case 42:
      // A set of instructions to be executed
      // when 'a' value equals to 42.
      break;
      case 20:
      // A set of instructions to be executed
      // when 'a' value equals to 20.
      case 30:
      // A set of instructions to be executed
      // when 'a' value equals to either 20 or 30.
      break;
      case 1:
      case 2:
      // A set of instructions to be executed
      // when 'a' value equals to 1 or 2.
      break;
      default:
      // A set of instructions to be executed
      // when 'a' does not match with any of the
      // cases described above.
    }
  \end{minted}
  \label{listing:dialogues-with-computer-switch-case}
  \caption{An example of \texttt{switch..case} usage.}
\end{listing}

In the listing \ref{listing:dialogues-with-computer-switch-case} an example of
\texttt{switch..case} statement is shown. As can be seen in this example the
value of \texttt{a} variable is sequentially compared with the values described
in \texttt{case} clauses.  The first \texttt{case} that will match the value of
the variable is executed and on the first \texttt{break} instruction the
\texttt{switch..case} exits.

Note that the \texttt{break} keyword shows the exit point of the
\texttt{switch..case}.  We can see in the example
\ref{listing:dialogues-with-computer-switch-case} that there are two
\texttt{case} instructions that go one after another -- the first one is for
number 20 and the second one is for number 30.  But the \texttt{break}
instruction is used only after the \texttt{case 30}.  It means that if
\texttt{a} variable is equal to 20 then not only the sequence of instructions
after \texttt{case 20} will be executed but the instructions after \texttt{case
  30} as well, without any further checks.  The same situation can be seen in
\texttt{case 1} and \texttt{case 2}, the difference is only that \texttt{case 1}
does not have any instructions to execute on its own, and the code \texttt{case
  2} will be executed instead.

Another very important idea to consider is that when we are using conditionals
in the code (also known as \emph{branching operators} for a good reason) they
are executed without any looping.  Nevertheless sometimes there is a temptation
to compare \emph{loop statements} with condition statements as they are both
using some condition that controls their execution.  It shouldn't be a surprise
as loops that we will discuss in \ref{Programming!Loops} are based on the
condition statements and can be implemented with the \texttt{if} statement.  In
the listing \ref{listing:dialogues-with-computer-if-based-loop} we provide an
example of loop implementation based on the plain \texttt{if} statement and a
global variable.

\begin{listing}[ht]
  \begin{minted}{cpp}
    void setup() {
      // Here we must configure ports 2..6 in OUTPUT
      // mode through 'pinMode' procedure.
    }

    // Create a global 'p' variable
    // that sets the number of LED.
    int p = 2;

    void loop() {
      // Do a single LED blinking.
      digitalWrite(p, HIGH);
      delay(100);
      digitalWrite(p, LOW);
      delay(100);

      p++; // Increment the variable.

      // If 'p' is equal to 7 then...
      if (p == 7) {
        // ...set the variable value to 2.
        p = 2;
      }
    }
  \end{minted}
  \label{listing:dialogues-with-computer-if-based-loop}
  \caption{An example of loop implementation through \texttt{if} operator.}
\end{listing}

Usually we don't use this approach as there are standalone loop operators that
we will discuss in the next section.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Loops}
\index{Programming!Loops}

Simple programs like ``Chasing lights'' that we did before can be written just
by simple copying and pasting the LED blinking algorithm (probably with some
modifications.)

Now imagine that we need to program ``Chasing lights'' using 100 LEDs.  That's a
tedious task, isn't it?  To avoid the dumb work of copying the same code many
times programmers came up with special control statements that are called
\emph{loops}.

There are several types of loops.  The main ones that we will need in the most
of the programming languages:
\begin{itemize}
\item Loop with a counter.
\item Pre-test loop.
\item Post-test loop.
\end{itemize}

Each of the loop type has its own implementation in the programming language
that we are using here (C++.)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Pre-Test Loop}
\index{Programming!Loops!Pre-test loop (while)}

The easiest type of a loop is the \emph{pre-test loop} that is implemented in
C++ as \texttt{while} statement.  This type of a loop comes handy when we don't
know the exact number of executions of a loop body that must be performed (in
other words when we don't know the exact number of \emph{iterations}.)

The overall structure of a \texttt{while} loop is shown in the listing
\ref{listing:dialogues-with-computer-while}.

\begin{listing}[ht]
  \begin{minted}{cpp}
    int t = 0;

    while (t < 12) {
      // Loop body.
    }
  \end{minted}
  \label{listing:dialogues-with-computer-while}
  \caption{Pre-test loop (\texttt{while}) example.}
\end{listing}

Often visualization of information helps us better understand the essence of the
matter.  One of the ways to visualize a loop is to draw a timeline that contains
the sequence of events as shown on fig. \ref{fig:control-flow-while-loop}.

\begin{figure}[ht]
  \centering
  \begin{tikzpicture}
    \draw[-{Stealth[gray]}] (0, 0) -- (11, 0);
    \foreach \x in {1, 2, ..., 10} {
      \draw (\x, 0.1) -- (\x, -0.1) node[below] {$\x$};
      \draw[dotted, red] (\x, 0.1) -- (\x, 0.5);
    };
    \draw (1.25, 0.5)  node[above, red] {\rotatebox[origin=l]{45}{$\mbox{int t = 0}$}};
    \draw (2.25, 0.5)  node[above, red] {\rotatebox[origin=l]{45}{$\mbox{t < 12}$}};
    \draw (3.50, 0.5)  node[above, red] {\rotatebox[origin=l]{45}{$\mbox{Loop body}$}};
    \draw (4.25, 0.5)  node[above, red] {\rotatebox[origin=l]{45}{$\mbox{t < 12}$}};
    \draw (5.50, 0.5)  node[above, red] {\rotatebox[origin=l]{45}{$\mbox{Loop body}$}};
    \draw (6.25, 0.5)  node[above, red] {\rotatebox[origin=l]{45}{$\mbox{t < 12}$}};
    \draw (7.50, 0.5)  node[above, red] {\rotatebox[origin=l]{45}{$\mbox{Loop body}$}};
    \draw (8.00, 0.5)  node[above, red] {$\mbox{...}$};
    \draw (11, 0) node[below] {$t$};
  \end{tikzpicture}
  \label{fig:control-flow-while-loop}
  \caption{A visualization of \texttt{while} loop.}
\end{figure}

As we can see here a loop is a process that spans over some period of time.
This process can be divided in the following steps:

\begin{enumerate}
\item Declare a variable and set its value to 0.
\item Check the condition of a loop.
\item If the condition is true, go to the loop body.
\item Checking the condition again (as on the step 2) -- if the condition is
  still evaluating to true, go to the loop body etc.
\end{enumerate}

The \texttt{while} loop is handy in situations where we need to repeat some set
of instructions and we know the loop condition.  At the same time the number of
repetitions can vary depending on the number of times when the loop condition
evaluates to ``true''.

Let's assume that fig. \ref{fig:control-flow-while-loop} represents some process
from the day-to-day life -- for example, you invited friends on your birthday
party and want to treat them with home-made cakes.  You have only time only
until 12 o'clock to prepare the cakes, so you start working on this task early
in the morning.  The process of producing one cake is well-known to you as it is
written in the recipe (in the algorithm), so you just need to follow this
algorithm.  After finishing a cake you look on a wall clock and if the time is
less than 12 o'clock then you continue to the making of the next cake and so on.
Thus, in the end the number of cakes can vary depending on your speed and the
complexity of the recipe, but you finish your at 12 o'clock.

It is important to write a correct end condition for a loop otherwise you can
end up making cakes not until the 12 o'clock of the current day but until the 12
o'clock of the next day or you can even go down into an \emph{infinite loop}.

\end{document}
